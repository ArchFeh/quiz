参考答案

0） 通用寄存器（X0-X31）的别名是不连续的，为什么？如临时寄存器是X5-X7, X28-X31; 被调用寄存器X8-X9，X18-X27

  压缩扩展（C）下的某些指令对寄存器使用有特别约定，某些指令只能使用S0-S1，A0-A5共8个寄存器，参考 P394, 表19.1
  RV32E只使用16个寄存器，RV32I的规范兼容了RV32E的ABI
  不连续的约定，目的是为了更好的兼容

  参考：
     Chapter 04 函数调用规范
     https://gist.github.com/mithro/3eb3089873a670ce2030c07555febe84

1）RISC-V PC（Program Counter）
  a）为什么PC没有设计成通用寄存器？

    参考 RISC-V-Reader-Chinese-v2p1.pdf P27 给出的解释：
      "程序计数器（PC）是 ARM-32 的 16 个寄存器之一，这意味着任何改变寄存器的指令
    都有可能导致分支跳转。PC 作为一个寄存器使硬件分支预测变得复杂，因为在典型的 ISA
    中，仅 10%-20%的指令为分支指令，而在 ARM-32 中，任何指令都有可能是分支指令。而
    分支预测的准确性对于良好的流水线性能至关重要。另外将 PC 作为一个寄存器也意味着
    可用的通用寄存器少了一个"

  b）如何获取PC的值

    使用auipc指令，imm部分应该为零
    auipc t0,0x0

2) 两个连续的寄存器是否可以传递一个更大的值?

  可以。riscv调用规范的原则是尽可能使用寄存器。所以在 rv32 里传递一个 64bit 整数 (如使用 RV32GC 编译 int64 的整数相加)，这时候就会使用两个寄存器来传递。
  示例: https://godbolt.org/z/Pzb1Te5zv

3) 香山处理器使用 RV64GCBK 指令集, 其中 CBK 都是扩展指令集, 这样是否会导致应用程序开发人员在设计过程考虑在对应的 RISC-V 处理器是否有对应的扩展指令集?

  此部分工作由编译器自动生成对应的指令，对开发人员透明。

4) 如何通过 M/S 模式的系统寄存器得知是否支持某一扩展?

  S 模式: 读取 sstatus 寄存器的 VS / FS / XS 字段。 P10,表1.6
  M 模式: 读取 misa 中 [25:0] 每位代表一个扩展。 P12,表1.8

5) U 态下如何调用 M 态寄存器?

  不能直接访问到M态寄存器，U态要陷入M态

6) 为什么通用寄存器 X0 的值为常数0?

  RISC-V 架构定义的，方便操作，
  有些指令可以直接用X0作为操作数来简化指令，参考 P62,表3.14
  X0还可以作为NULL的来使用（从而减少一条把寄存器的值设置为0的load指令）

7) 什么样的行为会触发非法指令异常？

  P8：
  访问不存在或者没有实现的系统寄存器
  尝试写入只有只读属性的系统寄存器
  在低级别的处理器模式下访问高级别的处理器模式的系统寄存器.

8) 进程是否可以在U模式下进行调度？

  P10/11: "一个进程需要调度, 它必须返回 S模式下的调度器里才能调度 (见 17.3.8 节)"

9) 32/64位系统,每个寄存器能存放多少位宽的数据,一个128位的数据,该如何存放?

docs: https://github.com/riscv-non-isa/riscv-elf-psabi-doc/blob/master/riscv-cc.adoc#integer-calling-convention

  32Bit系统通常寄存器也是32bit的，所以128bit数据可以存放在4个寄存器里
  64Bit 硬件不考虑运行 32bit 系统的情况下，也就是64bit一个寄存器，128bit数据可以存放在两个寄存器里

10) 以下这行代码,会用到哪些寄存器(rv64g指令集)?
  double a = 1 + 0.0d;

  可以查看反编译: https://godbolt.org/z/5bPo71b1d

11) 根据所实现的扩展的不同， RISC-V CPU 所拥有的寄存器是否会有差异，具体说明。

  有, 比如 P348 RVV为矢量计算提供了全新的寄存器组：32个矢量寄存器：v0-v31.7个非特权寄存器：vtype寄存器，v1寄存器，vlenb寄存器，vstart寄存器，vxrm寄存器，vxsat寄存器以及vcsr寄存器。

12) 各系统寄存器的各字段全称是什么？（方便记忆）

  https://book.rvemu.app/hardware-components/03-csrs.html

13) 通常情况下， RISC-V 内存模式使用大端还是小端？

  小端

14) 系统寄存器各节中频繁出现的「陷入」一词具体含义。

  http://xv6.dgs.zone/tranlate_books/book-riscv-rev1/c4/s1.html

15) 压缩指令存在的价值是什么？

  为常用操作增加16位指令编码来减少静态和动态代码大小。

16) 本书的学习目的，以及学完能实现的目标是什么？

17) 如果频繁调用 hpmcounter 系列寄存器，本身会对性能评估产生影响吗，如何解决这个问题？
  关键词: PMU

18) 不同特权级别下，所有的 riscv 拓展的语义和功能都一致吗？

19) 为什么 mstatus 和 status 只对 V 和 F 拓展有专门的使能位 VS 和 FS， XS 作为其他拓展使能的含义是什么？

20) 为什么香山处理器会出现高速缓存别名问题?为什么需要用硬件方式解决 VIPT别名问题?
